function(e,t,r){"use strict";r.d(t,{login:function(){return m}});var n=r(39501),i=r(75562),o=r(26679),a=r(14011),s=r(32063),u=r(26264),l=r(63486),c=r(69642);r(57437),r(2265);var d=r(86024),f=r(13127);r(58548);var h=r(10140),p=r(54465);let m=async e=>{var t,r,m,g,b,y,v,w,_,x,E,S;let k,A,{address:C,preserveAuthState:O,connectType:M,disableWalletType:I}=e,T=(0,o.g)(),N=(0,f.getWeb3AuthInstance)(),R=(0,d.WZ)();try{T.setState(e=>({...e,isLoading:!0,isLoginPending:!0})),await (0,n.z)(R),await N.logout({cleanup:!0}).catch(()=>{}),await (0,h.connectWeb3Auth)(M);let{address:e}=await function({wagmiConfig:e,...t}){return(0,c.y)({...t,get:()=>(0,u.D)(e),subscribe:t=>(0,l.u)(e,{onChange:e=>t(e)}),isDone:e=>!!e.address,timeoutMessage:"Timed out waiting for account"})}({wagmiConfig:R,timeoutMs:6e3}),a=C||e;if(!a)throw Error("No connected address found for login.");let d=(0,o.e)();await d.client.api.POST("/api/web/can-signin",{body:{}}),await d.client.api.GET("/api/web/account/{address}",{params:{path:{address:a}}});let f=(null==(t=(await d.client.api.POST("/api/web/message",{body:{address:a}})).data)?void 0:t.message)||"";await (0,s._)(200),k=await (0,i.l)(R,{message:f}),A=a;let v=await (0,p.i)(),w=await d.client.api.POST("/api/web/signin-wallet",{body:{address:a,signature:k,walletType:I?void 0:v}});return"u">typeof window&&null!==(S=null==(m=null==(r=null==window?void 0:window.OnetrustActiveGroups)?void 0:r.includes)?void 0:m.call(r,"C0002"))&&void 0!==S&&S&&(null==(y=null==(b=null==(g=null==window?void 0:window.$h)?void 0:g.a2s)?void 0:b.sendContentsLog)||y.call(b,"Login",JSON.stringify({accountno:a}))),T.setState(e=>({...e,isLoading:!1,isLoginPending:!1,isLogin:!0,address:a})),{...w.data,address:a}}catch(t){T.isTestMode&&(console.group("login error"),console.log("error:",t),console.log("error.code:",null==t?void 0:t.code),console.log("error.name:",null==t?void 0:t.name),console.log("error.message:",null==t?void 0:t.message),console.groupEnd());let e=null==t?void 0:t.code;throw O?T.setState(e=>({...e,isLoading:!1,isLoginPending:!1})):T.setState(e=>({...e,isLoading:!1,isLoginPending:!1,isLogin:!1,address:void 0})),(0,a.kW)(t)&&(null==(x=null==(_=null==(w=null==(v=t.response)?void 0:v.data)?void 0:w.details)?void 0:_[0])?void 0:x.code)!=="ACCOUNT_ERROR_CODE_NOT_FOUND_ACCOUNT"&&null!=N&&N.connected&&(T.isTestMode&&console.log("msu 계정이 없는 경우 지갑 연결해제"),(0,n.z)(R)),(4001===e||-32603===e)&&null!=N&&N.connected&&(0,n.z)(R),null==(E=null==N?void 0:N.loginModal)||E.closeModal(),void 0!==k&&(t.signature=k),void 0!==A&&(t.address=A),t}}}