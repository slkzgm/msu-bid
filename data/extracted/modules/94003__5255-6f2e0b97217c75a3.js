function(e,t,r){"use strict";r.r(t),r.d(t,{M:function(){return v},a:function(){return g},l:function(){return m},u:function(){return w}});var n=r(57437),i=r(2265),o=r(61868),a=r(57222),s=r(55997);let u=e=>{let t=(0,i.useRef)();return(0,i.useEffect)(()=>{t.current=e},[e]),t.current};var l=r(39501),c=r(26679);let d=e=>{(0,c.g)().setState(t=>({...t,isLoading:!1,isLogin:!0,...e}))};var f=r(86024);r(58548);let h=async()=>{let e=(0,c.g)(),t=e.fetch;try{e.setState(e=>({...e,isLoading:!0}));let{address:r}=(await t.api.POST("/api/web/token/verify",{body:{}})).data||{};e.setState(e=>({...e,isLoading:!1,isLogin:!0,address:r}))}catch(t){throw e.setState(e=>({...e,isLoading:!1,address:void 0,isLogin:!1})),t}};var p=r(60815);let m=async()=>{let e=(0,c.g)(),t=(0,f.WZ)(),r=e.fetch;try{await r.api.POST("/api/web/signout-web",{body:{}})}catch(e){throw e}finally{e.isTestMode&&console.log("logout 함수 호출"),await (0,l.z)(t),e.setState(()=>({isLoading:!1,address:void 0,isLogin:!1,isLoginPending:!1})),await e.executeLogoutCallbacks()}},g=e=>{let{isLoginPending:t,isLogin:r}=(0,p.u)(e.store),[n,a]=(0,i.useState)(!0),[s,u]=(0,i.useState)(!1);return(0,o.useAccountEffect)({onConnect(e){(async()=>{var r,n;if("u">typeof window&&!t){let t=JSON.parse(window.localStorage.getItem("msu_auth_store")||"{}");if(d({isLoading:!0}),null!=(r=null==t?void 0:t.state)&&r.isLogin){a(!0);try{await h(),u(!0),d({isLoading:!1,address:e.address,isLogin:!0})}catch(e){if((null==(n=null==e?void 0:e.response)?void 0:n.status)!==401)throw e;u(!1),d({isLoading:!1,isLogin:!1,address:void 0})}finally{a(!1)}}else u(!1),d({isLoading:!1,isLogin:!1,address:void 0})}})()},onDisconnect(){r&&(e.isTestMode&&console.log("지갑 연결해제 상태인경우 로그아웃"),m())}}),{isVerify:s,isLoading:n}},b=e=>{let{authConfig:t}=e,{isLogin:r,isLoading:n,address:o}=(0,p.u)(t.store),{isConnected:l,address:c}=(0,a.useAccount)(),f=l&&!n&&r&&o&&c&&o!==c,h=u(c),{isPreserveAuth:b}=(0,s.Z)(t);return g(t),(0,i.useEffect)(()=>{f&&(t.isTestMode&&console.log("계정 불일치 로그아웃"),m(),d({isLoading:!1,isLogin:!1,address:void 0}))},[f]),(0,i.useEffect)(()=>{l&&r&&c&&h&&c!==h&&!b&&(t.isTestMode&&console.log("계정 변경 시 로그아웃"),m())},[c,h,r,b,l]),null},y=(0,i.createContext)(void 0),v=e=>{let{children:t,authConfig:r}=e,[o,a]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{"u">typeof window&&a(!0)},[]),(0,n.jsxs)(y.Provider,{value:{authConfig:r,isMount:o},children:[t,(0,n.jsx)(b,{authConfig:r})]})},w=()=>{let e=(0,i.useContext)(y);if(!e)throw Error("`useAuthConfig` must be used within `AuthProvider`.\n");return e}}